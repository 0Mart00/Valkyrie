// prisma/schema.prisma

generator client {
provider        = "prisma-client-js"
previewFeatures = ["driverAdapters"]
}

datasource db {
provider = "postgresql"
// Az 'url' mező törölve - a prisma.config.ts kezeli
}

model User {
id        String    @id @default(uuid())
email     String    @unique
name      String?
avatarUrl String?
role      String    @default("DEV")
tasks     Task[]    @relation("TaskAssignee")
messages  Message[]
posts     Post[]
comments  Comment[]
}

model Project {
id        String    @id @default(uuid())
name      String
columns   Column[]
channels  Channel[]
posts     Post[]
}

model Column {
id        String @id @default(uuid())
title     String
order     Int
projectId String
project   Project @relation(fields: [projectId], references: [id])
tasks     Task[]
}

model Task {
id          String   @id @default(uuid())
title       String
description String?  @db.Text
priority    Priority @default(MEDIUM)
columnId    String
column      Column   @relation(fields: [columnId], references: [id])
assigneeId  String?
assignee    User?    @relation("TaskAssignee", fields: [assigneeId], references: [id])
createdAt   DateTime @default(now())
}

enum Priority {
LOW
MEDIUM
HIGH
CRITICAL
}

model Channel {
id        String      @id @default(uuid())
name      String
type      ChannelType @default(PROJECT)
level     String      @default("DEV")
password  String      @default("")
projectId String?
project   Project?    @relation(fields: [projectId], references: [id])
messages  Message[]
}

enum ChannelType {
GLOBAL
PROJECT
PRIVATE
}

model Message {
id        String   @id @default(uuid())
content   String
channelId String
channel   Channel  @relation(fields: [channelId], references: [id])
userId    String?

user      User?    @relation(fields: [userId], references: [id])
createdAt DateTime @default(now())
}

model Post {
id        String    @id @default(uuid())
content   String    @db.Text
imageUrl  String?
projectId String
project   Project   @relation(fields: [projectId], references: [id])
authorId  String
author    User      @relation(fields: [authorId], references: [id])
likes     Int       @default(0)
comments  Comment[]
createdAt DateTime  @default(now())
}

model Comment {
id        String   @id @default(uuid())
content   String
postId    String
post      Post     @relation(fields: [postId], references: [id])
authorId  String
author    User     @relation(fields: [authorId], references: [id])
}